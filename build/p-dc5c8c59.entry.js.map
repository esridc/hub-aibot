{"version":3,"names":["hubAibotCss","HubAibot","this","models","text","image","componentWillLoad","welcome","messages","push","async","message","response","fetch","method","headers","Authorization","apikey","body","JSON","stringify","model","role","content","personality","temperature","data","json","_b","_a","choices","console","debug","prompt","imageUrl","url","toggleChat","chatOpen","handleKeyDown","event","key","shiftKey","preventDefault","chatbotRef","textContent","trim","sendMessage","getImage","render","h","class","map","innerHTML","replace","contentEditable","onKeyDown","ref","el","onClick"],"sources":["./src/components/hub-aibot/hub-aibot.css?tag=hub-aibot&encapsulation=shadow","./src/components/hub-aibot/hub-aibot.tsx"],"sourcesContent":[":host {\n  display: block;\n  position: fixed;\n  bottom: 20px;\n  right: 20px;\n  z-index: 9999;\n}\n\n.fab {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 56px;\n  height: 56px;\n  border-radius: 50%;\n  background-color: #0077c2;\n  box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);\n  color: white;\n  font-size: 28px;\n  cursor: pointer;\n}\n\n.chat-window {\n  position: fixed;\n  bottom: 90px;\n  right: 20px;\n  width: 350px;\n  height: 400px;\n  border-radius: 10px;\n  background-color: white;\n  box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n}\n\n.messages {\n  padding: 10px;\n  height: 330px;\n  overflow-y: scroll;\n}\n\n.message {\n  margin-bottom: 10px;\n  padding: 10px;\n  border-radius: 10px;\n  background-color: #f5f5f5;\n}\n\n.input {\n  padding: 10px;\n  height: 60px;\n  border-top: 1px solid #e0e0e0;\n  outline: none;\n}\n\n.language-buttons {\n  display: flex;\n  justify-content: center;\n  margin-top: 10px;\n}\n\n.language-buttons button {\n  margin: 0 5px;\n  padding: 5px 10px;\n  border: none;\n  border-radius: 20px;\n  border-color: #0077c2;\n  background-color: white;\n  color: white;\n  font-size: 14px;\n  cursor: pointer;\n}\n\n.language-buttons button:focus {\n  outline: none;\n}\n\n.language-buttons button:active {\n  background-color: #005da8;\n}","import { Component, h, Prop, State } from '@stencil/core';\n\n@Component({\n  tag: 'hub-aibot',\n  styleUrl: 'hub-aibot.css',\n  shadow: true,\n})\nexport class HubAibot {\n  private chatbotRef!: HTMLDivElement;\n\n  @Prop() apikey = '';\n  @Prop() model = 'text'\n  @Prop() personality = \"You are writing for a government websites readable by 8th graders.\";\n  @Prop() chatOpen:boolean = false;\n  @Prop() welcome:string = null;\n  @State() messages: string[] = [];\n\n  models = {\n    'text': 'https://api.openai.com/v1/chat/completions',\n    'image': 'https://api.openai.com/v1/images/generations'\n  }\n\n  componentWillLoad() {\n    if(!!this.welcome) {\n      this.messages.push(this.welcome);\n    }\n  }\n  private async sendMessage(message: string) {\n    this.messages = [...this.messages, message];\n\n    const response = await fetch( this.models['text'], {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.apikey}`,\n      },\n      body: JSON.stringify({\n        model: \"gpt-3.5-turbo\",\n        messages: [\n          {\"role\": \"system\", \"content\": this.personality},\n          {role: \"user\", content: message}\n        ],\n        temperature: 0.4\n      }),\n    });\n\n    const data = await response.json();\n    const text = data.choices[0]?.message?.content;\n\n    console.debug(\"response\", {text})\n    this.messages = [...this.messages, text];\n  }\n\n  private async getImage(message: string) {\n    this.messages = [...this.messages, message];\n\n    const response = await fetch( this.models['image'], {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.apikey}`,\n      },\n      body: JSON.stringify({\n        prompt: message,\n      }),\n    });\n\n    const data = await response.json();\n    const imageUrl = data.data[0]?.url;\n\n    console.debug(\"response\", {imageUrl})\n    this.messages = [...this.messages, imageUrl];\n  }  \n\n  private toggleChat() {\n    this.chatOpen = !this.chatOpen;\n  }\n\n  private handleKeyDown(event: KeyboardEvent) {\n    if (event.key === 'Enter' && event.shiftKey === false) {\n      event.preventDefault();\n      const message = this.chatbotRef.textContent?.trim() || '';\n      \n      switch(this.model){\n        case 'text': \n          this.sendMessage(message);\n          break;\n        case 'image':\n          this.getImage(message);\n          break;\n      }\n      \n      \n      this.chatbotRef.textContent = '';\n    }\n  }\n\n  render() {\n    return (\n      <div>\n        {this.chatOpen ? (\n          <div class=\"chat-window\">\n            <div class=\"messages\">\n              {this.messages.map((message) => (\n                <div class=\"message\" innerHTML={message.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>')}></div>\n              ))}\n            </div>\n            <div\n              class=\"input\"\n              contentEditable={true}\n              onKeyDown={(event: KeyboardEvent) => this.handleKeyDown(event)}\n              ref={(el) => (this.chatbotRef = el!)}\n            ></div>\n          </div>\n        ) : null}\n        <div class=\"fab\" onClick={() => this.toggleChat()}>\n          <span class=\"material-icons\">&#129302;</span>\n        </div>\n      </div>\n    );\n  }\n}"],"mappings":"2CAAA,MAAMA,EAAc,0/B,MCOPC,EAAQ,M,yBAUnBC,KAAAC,OAAS,CACPC,KAAQ,6CACRC,MAAS,gD,YATM,G,WACD,O,iBACM,qE,cACK,M,aACF,K,cACK,E,CAO9BC,oBACE,KAAKJ,KAAKK,QAAS,CACjBL,KAAKM,SAASC,KAAKP,KAAKK,Q,EAGpBG,kBAAkBC,G,QACxBT,KAAKM,SAAW,IAAIN,KAAKM,SAAUG,GAEnC,MAAMC,QAAiBC,MAAOX,KAAKC,OAAO,QAAS,CACjDW,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChBC,cAAiB,UAAUd,KAAKe,UAElCC,KAAMC,KAAKC,UAAU,CACnBC,MAAO,gBACPb,SAAU,CACR,CAACc,KAAQ,SAAUC,QAAWrB,KAAKsB,aACnC,CAACF,KAAM,OAAQC,QAASZ,IAE1Bc,YAAa,OAIjB,MAAMC,QAAad,EAASe,OAC5B,MAAMvB,GAAOwB,GAAAC,EAAAH,EAAKI,QAAQ,MAAE,MAAAD,SAAA,SAAAA,EAAElB,WAAO,MAAAiB,SAAA,SAAAA,EAAEL,QAEvCQ,QAAQC,MAAM,WAAY,CAAC5B,SAC3BF,KAAKM,SAAW,IAAIN,KAAKM,SAAUJ,E,CAG7BM,eAAeC,G,MACrBT,KAAKM,SAAW,IAAIN,KAAKM,SAAUG,GAEnC,MAAMC,QAAiBC,MAAOX,KAAKC,OAAO,SAAU,CAClDW,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChBC,cAAiB,UAAUd,KAAKe,UAElCC,KAAMC,KAAKC,UAAU,CACnBa,OAAQtB,MAIZ,MAAMe,QAAad,EAASe,OAC5B,MAAMO,GAAWL,EAAAH,EAAKA,KAAK,MAAE,MAAAG,SAAA,SAAAA,EAAEM,IAE/BJ,QAAQC,MAAM,WAAY,CAACE,aAC3BhC,KAAKM,SAAW,IAAIN,KAAKM,SAAU0B,E,CAG7BE,aACNlC,KAAKmC,UAAYnC,KAAKmC,Q,CAGhBC,cAAcC,G,MACpB,GAAIA,EAAMC,MAAQ,SAAWD,EAAME,WAAa,MAAO,CACrDF,EAAMG,iBACN,MAAM/B,IAAUkB,EAAA3B,KAAKyC,WAAWC,eAAW,MAAAf,SAAA,SAAAA,EAAEgB,SAAU,GAEvD,OAAO3C,KAAKmB,OACV,IAAK,OACHnB,KAAK4C,YAAYnC,GACjB,MACF,IAAK,QACHT,KAAK6C,SAASpC,GACd,MAIJT,KAAKyC,WAAWC,YAAc,E,EAIlCI,SACE,OACEC,EAAA,WACG/C,KAAKmC,SACJY,EAAA,OAAKC,MAAM,eACTD,EAAA,OAAKC,MAAM,YACRhD,KAAKM,SAAS2C,KAAKxC,GAClBsC,EAAA,OAAKC,MAAM,UAAUE,UAAWzC,EAAQ0C,QAAQ,kBAAmB,aAGvEJ,EAAA,OACEC,MAAM,QACNI,gBAAiB,KACjBC,UAAYhB,GAAyBrC,KAAKoC,cAAcC,GACxDiB,IAAMC,GAAQvD,KAAKyC,WAAac,KAGlC,KACJR,EAAA,OAAKC,MAAM,MAAMQ,QAAS,IAAMxD,KAAKkC,cACnCa,EAAA,QAAMC,MAAM,kBAAgB,O"}