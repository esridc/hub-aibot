{"version":3,"names":["hiddenFormInputSlotName","isCheckable","component","onFormResetMap","WeakMap","formComponentSet","WeakSet","hasRegisteredFormComponentParent","form","formComponentEl","formComponentRegisterEventName","addEventListener","event","composedPath","some","element","has","stopPropagation","once","dispatchEvent","CustomEvent","bubbles","composed","submitForm","formEl","requestSubmit","submit","resetForm","reset","connectForm","el","value","closestElementCrossShadowBoundary","defaultValue","defaultChecked","checked","boundOnFormReset","onFormReset","bind","set","add","this","disconnectForm","get","removeEventListener","delete","afterConnectDefaultValueSet","hiddenInputChangeHandler","target","removeHiddenInputChangeEventListener","input","syncHiddenFormInput","name","ownerDocument","inputs","querySelectorAll","forEach","remove","values","Array","isArray","extra","seen","Set","valueMatch","find","val","defaultSyncHiddenFormInput","push","docFrag","pop","createElement","slot","createDocumentFragment","append","disabled","required","tabIndex","HiddenFormInputSlot","h"],"sources":["./node_modules/@esri/calcite-components/dist/collection/utils/form.js"],"sourcesContent":["/*!\n * All material copyright ESRI, All Rights Reserved, unless otherwise specified.\n * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.\n * v1.0.8-next.4\n */\nimport { closestElementCrossShadowBoundary } from \"./dom\";\nimport { h } from \"@stencil/core\";\n/**\n * Exported for testing purposes.\n */\nexport const hiddenFormInputSlotName = \"hidden-form-input\";\nfunction isCheckable(component) {\n  return \"checked\" in component;\n}\nconst onFormResetMap = new WeakMap();\nconst formComponentSet = new WeakSet();\nfunction hasRegisteredFormComponentParent(form, formComponentEl) {\n  // we use events as a way to test for nested form-associated components across shadow bounds\n  const formComponentRegisterEventName = \"calciteInternalFormComponentRegister\";\n  let hasRegisteredFormComponentParent = false;\n  form.addEventListener(formComponentRegisterEventName, (event) => {\n    hasRegisteredFormComponentParent = event\n      .composedPath()\n      .some((element) => formComponentSet.has(element));\n    event.stopPropagation();\n  }, { once: true });\n  formComponentEl.dispatchEvent(new CustomEvent(formComponentRegisterEventName, {\n    bubbles: true,\n    composed: true\n  }));\n  return hasRegisteredFormComponentParent;\n}\n/**\n * Helper to submit a form.\n *\n * @param component\n * @returns true if its associated form was submitted, false otherwise.\n */\nexport function submitForm(component) {\n  const { formEl } = component;\n  if (!formEl) {\n    return false;\n  }\n  \"requestSubmit\" in formEl ? formEl.requestSubmit() : formEl.submit();\n  return true;\n}\n/**\n * Helper to reset a form.\n *\n * @param component\n */\nexport function resetForm(component) {\n  component.formEl?.reset();\n}\n/**\n * Helper to set up form interactions on connectedCallback.\n *\n * @param component\n */\nexport function connectForm(component) {\n  const { el, value } = component;\n  const form = closestElementCrossShadowBoundary(el, \"form\");\n  if (!form || hasRegisteredFormComponentParent(form, el)) {\n    return;\n  }\n  component.formEl = form;\n  component.defaultValue = value;\n  if (isCheckable(component)) {\n    component.defaultChecked = component.checked;\n  }\n  const boundOnFormReset = (component.onFormReset || onFormReset).bind(component);\n  form.addEventListener(\"reset\", boundOnFormReset);\n  onFormResetMap.set(component.el, boundOnFormReset);\n  formComponentSet.add(el);\n}\nfunction onFormReset() {\n  if (isCheckable(this)) {\n    this.checked = this.defaultChecked;\n    return;\n  }\n  this.value = this.defaultValue;\n}\n/**\n * Helper to tear down form interactions on disconnectedCallback.\n *\n * @param component\n */\nexport function disconnectForm(component) {\n  const { el, formEl } = component;\n  if (!formEl) {\n    return;\n  }\n  const boundOnFormReset = onFormResetMap.get(el);\n  formEl.removeEventListener(\"reset\", boundOnFormReset);\n  onFormResetMap.delete(el);\n  component.formEl = null;\n  formComponentSet.delete(el);\n}\n/**\n * Helper for setting the default value on initialization after connectedCallback.\n *\n * Note that this is only needed if the default value cannot be determined on connectedCallback.\n *\n * @param component\n * @param value\n */\nexport function afterConnectDefaultValueSet(component, value) {\n  component.defaultValue = value;\n}\nconst hiddenInputChangeHandler = (event) => {\n  event.target.dispatchEvent(new CustomEvent(\"calciteInternalHiddenInputChange\", { bubbles: true }));\n};\nconst removeHiddenInputChangeEventListener = (input) => input.removeEventListener(\"change\", hiddenInputChangeHandler);\n/**\n * Helper for maintaining a form-associated's hidden input in sync with the component.\n *\n * Based on Ionic's approach: https://github.com/ionic-team/ionic-framework/blob/e4bf052794af9aac07f887013b9250d2a045eba3/core/src/utils/helpers.ts#L198\n *\n * @param component\n */\nfunction syncHiddenFormInput(component) {\n  const { el, formEl, name, value } = component;\n  const { ownerDocument } = el;\n  const inputs = el.querySelectorAll(`input[slot=\"${hiddenFormInputSlotName}\"]`);\n  if (!formEl || !name) {\n    inputs.forEach((input) => {\n      removeHiddenInputChangeEventListener(input);\n      input.remove();\n    });\n    return;\n  }\n  const values = Array.isArray(value) ? value : [value];\n  const extra = [];\n  const seen = new Set();\n  inputs.forEach((input) => {\n    const valueMatch = values.find((val) => \n    /* intentional non-strict equality check */\n    val == input.value);\n    if (valueMatch != null) {\n      seen.add(valueMatch);\n      defaultSyncHiddenFormInput(component, input, valueMatch);\n    }\n    else {\n      extra.push(input);\n    }\n  });\n  let docFrag;\n  values.forEach((value) => {\n    if (seen.has(value)) {\n      return;\n    }\n    let input = extra.pop();\n    if (!input) {\n      input = ownerDocument.createElement(\"input\");\n      input.slot = hiddenFormInputSlotName;\n    }\n    if (!docFrag) {\n      docFrag = ownerDocument.createDocumentFragment();\n    }\n    docFrag.append(input);\n    // emits when hidden input is autofilled\n    input.addEventListener(\"change\", hiddenInputChangeHandler);\n    defaultSyncHiddenFormInput(component, input, value);\n  });\n  if (docFrag) {\n    el.append(docFrag);\n  }\n  extra.forEach((input) => {\n    removeHiddenInputChangeEventListener(input);\n    input.remove();\n  });\n}\nfunction defaultSyncHiddenFormInput(component, input, value) {\n  const { defaultValue, disabled, name, required } = component;\n  // keep in sync to prevent losing reset value\n  input.defaultValue = defaultValue;\n  input.disabled = disabled;\n  input.name = name;\n  input.required = required;\n  input.tabIndex = -1;\n  if (isCheckable(component)) {\n    input.checked = component.checked;\n    // keep in sync to prevent losing reset value\n    input.defaultChecked = component.defaultChecked;\n    // heuristic to support default/on mode from https://html.spec.whatwg.org/multipage/input.html#dom-input-value-default-on\n    input.value = component.checked ? value || \"on\" : \"\";\n  }\n  else {\n    input.value = value || \"\";\n  }\n  component.syncHiddenFormInput?.(input);\n}\n/**\n * Helper to render the slot for form-associated component's hidden input.\n *\n * If the component has a default slot, this must be placed at the bottom of the component's root container to ensure it is the last child.\n *\n * render(): VNode {\n *   <Host>\n *     <div class={CSS.container}>\n *     // ...\n *     <HiddenFormInputSlot component={this} />\n *     </div>\n *   </Host>\n * }\n *\n * Note that the hidden-form-input Sass mixin must be added to the component's style to apply specific styles.\n *\n * @param root0\n * @param root0.component\n */\nexport const HiddenFormInputSlot = ({ component }) => {\n  syncHiddenFormInput(component);\n  return h(\"slot\", { name: hiddenFormInputSlotName });\n};\n"],"mappings":"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"}