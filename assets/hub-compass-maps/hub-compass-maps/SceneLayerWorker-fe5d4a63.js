import { c6 as a$1, aE as f } from './hub-compass-map-68308039.js';
import { p as p$1, m as m$2, y as y$1 } from './MeshLocalVertexSpace-4ffdc792.js';
import { m as m$1 } from './MeshGeoreferencedRelativeVertexSpace-0c644d12.js';
import { n as n$3, s as s$1 } from './vec32-62104995.js';
import { E as E$1 } from './sphere-770223d9.js';
import './index-d436d5f8.js';
import './ByteSizeUnit-f75ee973.js';
import './mat3f64-9c2c37f3.js';
import './mat4f64-f2ca62fb.js';
import './quatf64-581a0ed6.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
var n$2,e$1;!function(n){n[n.None=0]="None",n[n.Int16=1]="Int16",n[n.Int32=2]="Int32";}(n$2||(n$2={})),function(n){n[n.Replace=0]="Replace",n[n.Outside=1]="Outside",n[n.Inside=2]="Inside",n[n.Finished=3]="Finished";}(e$1||(e$1={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
function e(){return n$1||(n$1=new Promise((t=>import('./i3s-7199ff61.js').then((t=>t.i)).then((({default:e})=>{const n=e({locateFile:i$1,onRuntimeInitialized:()=>t(n)});delete n.then;})))).catch((t=>{throw t}))),n$1}function i$1(e){return a$1(`esri/libs/i3s/${e}`)}let n$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
class t{constructor(t,i){this.id=t,this.mbs=i,this.renderMbs=E$1(0,0,0,-1),this.elevationRange=null;}}class i{constructor(){this.min=1/0,this.max=-1/0,this.valid=!1;}}var n,o,s,a,c$1;!function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked";}(n||(n={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked";}(o||(o={}));class h$1 extends t{constructor(e,t,i,n,a,c,h,d,r,l){super(e,i),this.index=t,this.childCount=n,this.level=a,this.resources=c,this.version=h,this.lodMetric=d,this.maxError=r,this.numFeatures=l,this.failed=!1,this.cacheState=s.Unknown,this.vertexCount=0,this.memory=0,this.childrenLoaded=0,this.hasModifications=!1,this.imModificationImpact=o.NotChecked;}}!function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached";}(s||(s={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera";}(a||(a={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf";}(c$1||(c$1={}));class d$1{constructor(e,t,i,n){this.nodeHasLOD=e,this.isChosen=t,this.lodLevel=i,this.version=n;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
async function c(e){await j();const r=[e.geometryBuffer];return {result:A(e,r),transferList:r}}async function u(e){await j();const r=[e.geometryBuffer],{geometryBuffer:t}=e,o=t.byteLength,n=E._malloc(o),s=new Uint8Array(E.HEAPU8.buffer,n,o);s.set(new Uint8Array(t));const i=E.dracoDecompressPointCloudData(n,s.byteLength);if(E._free(n),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);const a=i.featureIds?.length>0?i.featureIds.slice():null,f=i.positions.slice();return a&&r.push(a.buffer),r.push(f.buffer),{result:{positions:f,featureIds:a},transferList:r}}async function m(e){await j(),S(e);const r={buffer:e.buffer};return {result:r,transferList:[r.buffer]}}async function y(e){await j(),w(e);}async function p(e){await j(),E.setLegacySchema(e.context,e.jsonSchema);}async function d(s){const{localMatrix:i,origin:a,positions:f$1,vertexSpace:l,local:c}=s,u=f.fromJSON(s.inSpatialReference),m=f.fromJSON(s.outSpatialReference),y={georeferenced:p$1,georeferencedRelative:m$1,local:m$2}[l.type].fromJSON(l);let p;if("georeferenced"===y.type){const{projectBuffer:e,initializeProjection:r}=await import('./hub-compass-map-68308039.js').then(function (n) { return n.mU; });await r(u,m),p=new Float64Array(f$1.length),e(f$1,u,0,p,m,0,p.length/3);}else {const{project:e}=await import('./georeference-961e5357.js').then(function (n) { return n.c; });p=y$1(e({positions:f$1,transform:i?{localMatrix:i}:void 0,vertexSpace:y,inSpatialReference:u,outSpatialReference:m,local:c}));}const d=p.length,[b,h,g]=a;for(let e=0;e<d;e+=3)p[e]-=b,p[e+1]-=h,p[e+2]-=g;return {result:{projected:p,original:f$1},transferList:[p.buffer,f$1.buffer]}}async function b({normalMatrix:e,normals:r}){const t=new Float32Array(r.length);return n$3(t,r,e),s$1(t,t),{result:{transformed:t,original:r},transferList:[t.buffer,r.buffer]}}function h(e){_(e);}let g,E;function w(e){const r=e.modifications,t=E._malloc(8*r.length),o=new Float64Array(E.HEAPU8.buffer,t,r.length);for(let n=0;n<r.length;++n)o[n]=r[n];E.setModifications(e.context,t,r.length,e.isGeodetic),E._free(t);}function A(e,r){if(!E)return null;const{context:t,localOrigin:o,globalTrafo:n,mbs:s,obb:i,elevationOffset:f,geometryBuffer:l,geometryDescriptor:c,indexToVertexProjector:u,vertexToRenderProjector:m}=e,y=E._malloc(l.byteLength),p=33,d=E._malloc(p*Float64Array.BYTES_PER_ELEMENT),b=new Uint8Array(E.HEAPU8.buffer,y,l.byteLength);b.set(new Uint8Array(l));const h=new Float64Array(E.HEAPU8.buffer,d,p);I(h,o);let g=h.byteOffset+3*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g);I(w,n),g+=16*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g),I(w,s),g+=4*h.BYTES_PER_ELEMENT,null!=i&&(w=new Float64Array(h.buffer,g),I(w,i.center),g+=3*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g),I(w,i.halfSize),g+=3*h.BYTES_PER_ELEMENT,w=new Float64Array(h.buffer,g),I(w,i.quaternion));const A=c,L={isDraco:!1,isLegacy:!1,color:e.layouts.some((e=>e.some((e=>"color"===e.name)))),normal:e.needNormals&&e.layouts.some((e=>e.some((e=>"normalCompressed"===e.name)))),uv0:e.layouts.some((e=>e.some((e=>"uv0"===e.name)))),uvRegion:e.layouts.some((e=>e.some((e=>"uvRegion"===e.name)))),featureIndex:A.featureIndex},S=E.process(t,!!e.obb,y,b.byteLength,A,L,d,f,u,m,e.normalReferenceFrame);if(E._free(d),E._free(y),S.error.length>0)throw new Error(`i3s.wasm: ${S.error}`);if(S.discarded)return null;const _=S.componentOffsets.length>0?S.componentOffsets.slice():null,j=S.featureIds.length>0?S.featureIds.slice():null,x=S.anchorIds.length>0?Array.from(S.anchorIds):null,T=S.anchors.length>0?Array.from(S.anchors):null,M=S.interleavedVertedData.slice().buffer,P=S.indicesType===n$2.Int16?new Uint16Array(S.indices.buffer,S.indices.byteOffset,S.indices.byteLength/2).slice():new Uint32Array(S.indices.buffer,S.indices.byteOffset,S.indices.byteLength/4).slice(),R=S.positions.slice(),U=S.positionIndicesType===n$2.Int16?new Uint16Array(S.positionIndices.buffer,S.positionIndices.byteOffset,S.positionIndices.byteLength/2).slice():new Uint32Array(S.positionIndices.buffer,S.positionIndices.byteOffset,S.positionIndices.byteLength/4).slice(),v={layout:e.layouts[0],interleavedVertexData:M,indices:P,hasColors:S.hasColors,hasModifications:S.hasModifications,positionData:{data:R,indices:U}};return j&&r.push(j.buffer),_&&r.push(_.buffer),r.push(M),r.push(P.buffer),r.push(R.buffer),r.push(U.buffer),{componentOffsets:_,featureIds:j,anchorIds:x,anchors:T,transformedGeometry:v,obb:S.obb}}function L(e){return 0===e?o.Unmodified:1===e?o.PotentiallyModified:2===e?o.Culled:o.Unknown}function S(e){const{context:r,buffer:t}=e,o=E._malloc(t.byteLength),n=t.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(E.HEAPU8.buffer,o,n),i=new Float64Array(t);s.set(i),E.filterOBBs(r,o,n),i.set(s),E._free(o);}function _(e){E&&(E.destroy(e),E=null);}function I(e,r){for(let t=0;t<r.length;++t)e[t]=r[t];}function j(){return E?Promise.resolve():(g||(g=e().then((e=>{E=e,g=null;}))),g)}const x={transform:A,destroy:_};

export { h as destroyContext, u as dracoDecompressPointCloudData, m as filterObbsForModifications, S as filterObbsForModificationsSync, j as initialize, L as interpretObbModificationResults, c as process, d as project, p as setLegacySchema, y as setModifications, w as setModificationsSync, x as test, b as transformNormals };

//# sourceMappingURL=SceneLayerWorker-fe5d4a63.js.map