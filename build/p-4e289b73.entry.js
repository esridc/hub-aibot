import{r as t,h as e}from"./p-5b036533.js";
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */const o="calcite-mode-auto";const n="calcite-mode-dark";
/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.8-next.4
 */function i(){const{classList:t}=document.body;const e=window.matchMedia("(prefers-color-scheme: dark)").matches;const i=()=>t.contains(n)||t.contains(o)&&e?"dark":"light";const s=t=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:true,detail:{mode:t}}));const a=t=>{r!==t&&s(t);r=t};let r=i();s(r);window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(t=>a(t.matches?"dark":"light")));new MutationObserver((()=>a(i()))).observe(document.body,{attributes:true,attributeFilter:["class"]})}function s(){const t=typeof window!=="undefined"&&typeof location!=="undefined"&&typeof document!=="undefined"&&window.location===location&&window.document===document;if(t){if(document.readyState==="interactive"){i()}else{document.addEventListener("DOMContentLoaded",(()=>i()),{once:true})}}}const a=s;a();var r;(function(t){t["Nearby"]="nearby";t["Text"]="text";t["Image"]="image"})(r||(r={}));async function c(t,e="en",o,n){var i,s;const a={en:"gpt-3.5-turbo",es:"curie",fr:"davinci"};const r=a[e]||"gpt-3.5-turbo";const c=await fetch(this.models["text"],{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:r,messages:[{role:"system",content:o},{role:"user",content:t}],temperature:.4})});const l=await c.json();const d=(s=(i=l.choices[0])===null||i===void 0?void 0:i.message)===null||s===void 0?void 0:s.content;return d}async function l(t,e){var o;const n=await fetch(this.models["image"],{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({prompt:t})});const i=await n.json();const s=(o=i.data[0])===null||o===void 0?void 0:o.url;return s}const d=":host{display:block;position:fixed;bottom:20px;right:20px;z-index:9999}.fab{display:flex;justify-content:center;align-items:center;position:relative;color:white;font-size:28px;cursor:pointer;transition:width 0.3s;width:140px}.fab:hover .fab-icon{background-color:gray;border-color:#0077c2}.fab .fab-icon{width:56px;background-color:#0077c2;width:56px;height:56px;border-radius:50%;box-shadow:0px 4px 10px rgba(0, 0, 0, 0.1)}.tooltip{position:absolute;top:-30px;left:0;right:0;margin:auto;display:none;background-color:rgba(0, 0, 0, 0.8);color:white;padding:4px 8px;border-radius:4px;font-size:12px;text-align:center;pointer-events:none}.fab:hover .tooltip{display:block}.chat-window{position:fixed;bottom:90px;right:20px;width:350px;height:400px;border-radius:10px;background-color:white;box-shadow:0px 4px 10px rgba(0, 0, 0, 0.1);overflow:hidden}.intro{padding:10px;font-size:14px;line-height:1.5}.messages{padding:10px;height:150px;overflow-y:scroll}.message{margin-bottom:10px;padding:10px;border-radius:10px;background-color:#f5f5f5}.loading{display:flex;align-items:center;justify-content:center;height:40px}.dot{display:inline-block;width:8px;height:8px;margin:0 2px;background-color:#0077c2;border-radius:50%;animation:dot-pulse 1.2s infinite ease-in-out}@keyframes dot-pulse{0%{transform:scale(1)}50%{transform:scale(1.3)}100%{transform:scale(1)}}.input-container{display:flex;align-items:center;padding:10px;border-top:1px solid #e0e0e0}.input{flex-grow:1;padding:6px 10px;border:none;outline:none;resize:none;font-size:14px}.send-button{display:flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:50%;background-color:#0077c2;color:white;font-size:20px;border:none;cursor:pointer;margin-left:8px}.send-button:hover{background-color:#005ea6}.example-prompts{display:flex;justify-content:center;padding:10px}.example-prompts button{margin:0 5px;padding:8px 16px;border:none;border-radius:20px;background-color:#0077c2;color:white;font-size:14px;cursor:pointer}.example-prompts button:focus{outline:none}.example-prompts button:active{background-color:#005da8}.language-buttons{display:flex;justify-content:center;margin-top:10px}.language-buttons button{margin:0 5px;padding:5px 10px;border:none;border-radius:20px;background-color:#0077c2;color:white;font-size:14px;cursor:pointer}.language-buttons button:focus{outline:none}.language-buttons button:active{background-color:#005da8}";const p=class{constructor(e){t(this,e);this.models={nearby:"http://localui.arcgis.com:8000/chat",text:"https://api.openai.com/v1/chat/completions",image:"https://api.openai.com/v1/images/generations"};this.apikey="";this.model=r.Nearby;this.personality="You are writing for a government websites readable by 8th graders.";this.chatOpen=false;this.welcome=null;this.messages=[];this.loading=false}componentWillLoad(){if(!!this.welcome){this.messages.push(this.welcome)}}async sendNearby(t){this.messages=[...this.messages,t];this.loading=true;const e=await fetch(this.models["nearby"]+"?"+new URLSearchParams({query:t}));const o=await e.text();console.debug("response",{text:o});this.messages=[...this.messages,o];this.loading=false}async sendMessage(t,e="en"){this.messages=[...this.messages,t];this.loading=true;const o=await c(t,e,this.personality,this.apikey);console.debug("response",{text:o});this.messages=[...this.messages,o];this.loading=false}async getImage(t){this.messages=[...this.messages,t];this.loading=true;const e=await l(t,this.apikey);console.debug("response",{imageUrl:e});this.messages=[...this.messages,e];this.loading=false}toggleChat(){this.chatOpen=!this.chatOpen}handleKeyDown(t){var e;if(t.key==="Enter"&&t.shiftKey===false){t.preventDefault();const o=((e=this.chatbotRef.textContent)===null||e===void 0?void 0:e.trim())||"";console.debug("calling model",[this.model,o]);switch(this.model){case r.Nearby:this.sendNearby(o);break;case r.Text:this.sendMessage(o);break;case r.Image:this.getImage(o);break}this.chatbotRef.textContent=""}}render(){return e("div",null,this.chatOpen?e("div",{class:"chat-window"},this.renderIntro(),e("div",{class:"messages"},this.messages.map((t=>e("div",{class:"message",innerHTML:t.replace(/(?:\r\n|\r|\n)/g,"<br>")}))),this.loading?this.renderLoading():null),e("div",{class:"input-container"},e("div",{class:"input",contentEditable:true,onKeyDown:t=>this.handleKeyDown(t),ref:t=>this.chatbotRef=t}),e("button",{class:"send-button",onClick:()=>this.sendMessage("en")},e("calcite-icon",{icon:"send","text-label":"Send message"}))),e("div",{class:"example-prompts"},e("button",{onClick:()=>this.sendMessage("Tell me about your services.","en")},"Services"),e("button",{onClick:()=>this.sendMessage("What are your office hours?","en")},"Office Hours"))):null,e("div",{class:"fab",onClick:()=>this.toggleChat()},e("span",{class:"tooltip"},"Open Hub Compass"),e("calcite-icon",{class:"fab-icon",icon:"explore","text-label":"Open Hub Compass"})))}renderLoading(){return e("div",{class:"loading"},e("div",{class:"dot"}),e("div",{class:"dot"}),e("div",{class:"dot"}))}renderIntro(){return e("div",{class:"intro"},e("p",null,"Welcome to the Hub Compass Chatbot!"),e("p",null,"How can I assist you today?"))}};p.style=d;export{p as hub_aibot};
//# sourceMappingURL=p-4e289b73.entry.js.map