import{s as t}from"./p-6e236ea4.js";var e;(function(t){t["Popup"]="popup";t["Modal"]="modal"})(e||(e={}));var n;(function(t){t["Nearby"]="nearby";t["Text"]="text";t["Image"]="image"})(n||(n={}));var r;(function(t){t["user"]="user";t["hub"]="hub";t["system"]="system"})(r||(r={}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var i=function(t,e){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n]};return i(t,e)};function o(t,e){i(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){a=Object.assign||function t(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o))e[o]=n[o]}return e};return a.apply(this,arguments)};function s(t,e){var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0)n[r]=t[r];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++){if(e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i]))n[r[i]]=t[r[i]]}return n}function u(t){return Object.keys(t).some((function(e){var n=t[e];if(!n){return false}if(n&&n.toParam){n=n.toParam()}var r=n.constructor.name;switch(r){case"Array":return false;case"Object":return false;case"Date":return false;case"Function":return false;case"Boolean":return false;case"String":return false;case"Number":return false;default:return true}}))}function c(t){var e={};Object.keys(t).forEach((function(n){var r,i;var o=t[n];if(o&&o.toParam){o=o.toParam()}if(!o&&o!==0&&typeof o!=="boolean"&&typeof o!=="string"){return}var a=o.constructor.name;var s;switch(a){case"Array":var u=(i=(r=o[0])===null||r===void 0?void 0:r.constructor)===null||i===void 0?void 0:i.name;s=u==="Array"?o:u==="Object"?JSON.stringify(o):o.join(",");break;case"Object":s=JSON.stringify(o);break;case"Date":s=o.valueOf();break;case"Function":s=null;break;case"Boolean":s=o+"";break;default:s=o;break}if(s||s===0||typeof s==="string"||Array.isArray(s)){e[n]=s}}));return e}function f(t,e){if(Array.isArray(e)&&e[0]&&Array.isArray(e[0])){return e.map((function(e){return f(t,e)})).join("&")}return encodeURIComponent(t)+"="+encodeURIComponent(e)}function h(t){var e=c(t);return Object.keys(e).map((function(t){return f(t,e[t])})).join("&")}function l(t,e){var n=u(t)||e;var r=c(t);if(n){var i=new FormData;Object.keys(r).forEach((function(t){if(typeof Blob!=="undefined"&&r[t]instanceof Blob){var e=r["fileName"]||r[t].name||t;i.append(t,r[t],e)}else if(r[t].constructor&&r[t].constructor.name==="ReadStream"&&Number.isInteger(r["dataSize"])){i.append(t,r[t],{knownLength:r["dataSize"]})}else{i.append(t,r[t])}}));return i}else{return h(t)}}var d=function(){function t(t,e,n,r,i){t=t||"UNKNOWN_ERROR";e=e||"UNKNOWN_ERROR_CODE";this.name="ArcGISRequestError";this.message=e==="UNKNOWN_ERROR_CODE"?t:e+": "+t;this.originalMessage=t;this.code=e;this.response=n;this.url=r;this.options=i}return t}();d.prototype=Object.create(Error.prototype);d.prototype.constructor=d;function p(t){if(console&&console.warn){console.warn.apply(console,[t])}}var m="@esri/arcgis-rest-js";var v={httpMethod:"POST",params:{f:"json"}};var y=function(t){o(e,t);function e(e,n,r,i,o){if(e===void 0){e="AUTHENTICATION_ERROR"}if(n===void 0){n="AUTHENTICATION_ERROR_CODE"}var a=t.call(this,e,n,r,i,o)||this;a.name="ArcGISAuthError";a.message=n==="AUTHENTICATION_ERROR_CODE"?e:n+": "+e;return a}e.prototype.retry=function(t,e){var n=this;if(e===void 0){e=3}var r=0;var i=function(o,s){t(n.url,n.options).then((function(t){var e=a(a({},n.options),{authentication:t});r=r+1;return w(n.url,e)})).then((function(t){o(t)})).catch((function(t){if(t.name==="ArcGISAuthError"&&r<e){i(o,s)}else if(t.name==="ArcGISAuthError"&&r>=e){s(n)}else{s(t)}}))};return new Promise((function(t,e){i(t,e)}))};return e}(d);function b(t,e,n,r,i){if(t.code>=400){var o=t.message,a=t.code;throw new d(o,a,t,e,r)}if(t.error){var s=t.error,o=s.message,a=s.code,u=s.messageCode;var c=u||a||"UNKNOWN_ERROR_CODE";if(a===498||a===499||u==="GWM_0003"||a===400&&o==="Unable to generate token."){if(i){throw i}else{throw new y(o,c,t,e,r)}}throw new d(o,c,t,e,r)}if(t.status==="failed"||t.status==="failure"){var o=void 0;var a="UNKNOWN_ERROR_CODE";try{o=JSON.parse(t.statusMessage).message;a=JSON.parse(t.statusMessage).code}catch(e){o=t.statusMessage||t.message}throw new d(o,a,t,e,r)}return t}function w(t,e){if(e===void 0){e={params:{f:"json"}}}var n=a(a(a({httpMethod:"POST"},v),e),{params:a(a({},v.params),e.params),headers:a(a({},v.headers),e.headers)});var r=[];var i=[];if(!n.fetch&&typeof fetch!=="undefined"){n.fetch=fetch.bind(Function("return this")())}else{r.push("`fetch`");i.push("`node-fetch`")}if(typeof Promise==="undefined"){r.push("`Promise`");i.push("`es6-promise`")}if(typeof FormData==="undefined"){r.push("`FormData`");i.push("`isomorphic-form-data`")}if(!n.fetch||typeof Promise==="undefined"||typeof FormData==="undefined"){throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+r.join(", ")+". We recommend installing the "+i.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.")}var o=n.httpMethod,s=n.authentication,c=n.rawResponse;var f=a({f:"json"},n.params);var p=null;var y={method:o,credentials:n.credentials||"same-origin"};if(n.headers&&n.headers["X-Esri-Auth-Client-Id"]&&t.indexOf("/oauth2/platformSelf")>-1){y.credentials="include"}return(s?s.getToken(t,{fetch:n.fetch}).catch((function(e){e.url=t;e.options=n;p=e;return Promise.resolve("")})):Promise.resolve("")).then((function(e){if(e.length){f.token=e}if(s&&s.getDomainCredentials){y.credentials=s.getDomainCredentials(t)}var r={};if(y.method==="GET"){if(f.token&&n.hideToken&&typeof window==="undefined"){r["X-Esri-Authorization"]="Bearer "+f.token;delete f.token}var i=h(f);var o=i===""?t:t+"?"+h(f);if(n.maxUrlLength&&o.length>n.maxUrlLength||f.token&&n.hideToken){y.method="POST";if(e.length&&n.hideToken){f.token=e;delete r["X-Esri-Authorization"]}}else{t=o}}var c=new RegExp("/items/.+/updateResources").test(t);if(y.method==="POST"){y.body=l(f,c)}y.headers=a(a({},r),n.headers);if(typeof window==="undefined"&&!y.headers.referer){y.headers.referer=m}if(!u(f)&&!c){y.headers["Content-Type"]="application/x-www-form-urlencoded"}return n.fetch(t,y)})).then((function(e){if(!e.ok){var r=e.status,i=e.statusText;throw new d(i,"HTTP "+r,e,t,n)}if(c){return e}switch(f.f){case"json":return e.json();case"geojson":return e.json();case"html":return e.text();case"text":return e.text();default:return e.blob()}})).then((function(e){if((f.f==="json"||f.f==="geojson")&&!c){var r=b(e,t,f,n,p);if(p){var i=t.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];n.authentication.federatedServers[i]={token:[],expires:new Date(Date.now()+86400*1e3)};p=null}return r}else{return e}}))}function O(t,e,n){var r=["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"];var i=a(a({params:{}},n),t);i.params=e.reduce((function(e,n){if(t[n]||typeof t[n]==="boolean"){e[n]=t[n]}return e}),i.params);return r.reduce((function(t,e){if(i[e]){t[e]=i[e]}return t}),{})}function g(t){if(typeof t!=="string"){return t}t=t.trim();if(t[t.length-1]==="/"){t=t.slice(0,-1)}return t}function j(t){const{host:e,path:n,query:r}=t;const i=e.endsWith("/")?e:`${e}/`;const o=new URL(n,i);o.search=E(r);return o.toString()}function E(t={}){const e=Object.keys(t).filter((e=>t[e]!==undefined)).reduce(((e,n)=>{e[n]=t[n];return e}),{});return new URLSearchParams(e).toString()}function R(t){if(t===void 0){t={}}if(t.portal){return g(t.portal)}if(t.authentication){return t.authentication.portal}return"https://www.arcgis.com/sharing/rest"}var _=function(){function t(t){if(t===void 0){t=""}this.termStack=[];this.rangeStack=[];this.openGroups=0;this.q=t}t.prototype.match=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}this.termStack=this.termStack.concat(t);return this};t.prototype.in=function(t){var e="`in("+(t?'"'+t+'"':"")+")`";if(!this.hasRange&&!this.hasTerms){p(e+" was called with no call to `match(...)` or `from(...)`/`to(...)`. Your query was not modified.");return this}if(t&&t!=="*"){this.q+=t+":"}return this.commit()};t.prototype.startGroup=function(){this.commit();if(this.openGroups>0){this.q+=" "}this.openGroups++;this.q+="(";return this};t.prototype.endGroup=function(){if(this.openGroups<=0){p("`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified.");return this}this.commit();this.openGroups--;this.q+=")";return this};t.prototype.and=function(){return this.addModifier("and")};t.prototype.or=function(){return this.addModifier("or")};t.prototype.not=function(){return this.addModifier("not")};t.prototype.from=function(t){if(this.hasTerms){p('`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.');return this}this.rangeStack[0]=t;return this};t.prototype.to=function(t){if(this.hasTerms){p('`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.');return this}this.rangeStack[1]=t;return this};t.prototype.boost=function(t){this.commit();this.q+="^"+t;return this};t.prototype.toParam=function(){this.commit();this.cleanup();return this.q};t.prototype.clone=function(){this.commit();this.cleanup();return new t(this.q+"")};t.prototype.addModifier=function(t){if(this.currentModifer){p("You have called `"+this.currentModifer+"()` after `"+t+"()`. Your current query was not modified.");return this}this.commit();if(this.q===""&&t!=="not"){p("You have called `"+t+"()` without calling another method to modify your query first. Try calling `match()` first.");return this}this.currentModifer=t;this.q+=this.q===""?"":" ";this.q+=t.toUpperCase()+" ";return this};t.prototype.needsQuotes=function(t){return/\s|:/g.test(t)};t.prototype.formatTerm=function(t){if(t instanceof Date){return t.getTime()}if(typeof t==="string"&&this.needsQuotes(t)){return'"'+t+'"'}return t};t.prototype.commit=function(){var t=this;this.currentModifer=undefined;if(this.hasRange){this.q+="["+this.formatTerm(this.rangeStack[0])+" TO "+this.formatTerm(this.rangeStack[1])+"]";this.rangeStack=[undefined,undefined]}if(this.hasTerms){this.q+=this.termStack.map((function(e){return t.formatTerm(e)})).join(" ");this.termStack=[]}return this};Object.defineProperty(t.prototype,"hasTerms",{get:function(){return this.termStack.length>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"hasRange",{get:function(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]},enumerable:false,configurable:true});t.prototype.cleanup=function(){if(this.openGroups>0){p("Automatically closing "+this.openGroups+" group(s). You can use `endGroup(...)` to remove this warning.");while(this.openGroups>0){this.q+=")";this.openGroups--}}var t=this.q;this.q=t.replace(/( AND ?| NOT ?| OR ?)*$/,"");if(t!==this.q){p("`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified.")}this.q=this.q.replace(/(\(\))*/,"")};return t}();function N(t,e){var n;if(typeof t==="string"||t instanceof _){n={httpMethod:"GET",params:{q:t}}}else{n=O(t,["q","num","start","sortField","sortOrder","searchUserAccess","searchUserName","filter","countFields","countSize","categories","categoryFilters"],{httpMethod:"GET"})}var r;switch(e){case"item":r="/search";break;case"group":r="/community/groups";break;case"groupContent":if(typeof t!=="string"&&!(t instanceof _)&&t.groupId){r="/content/groups/"+t.groupId+"/search"}else{return Promise.reject(new Error("you must pass a `groupId` option to `searchGroupContent`"))}break;default:r="/portals/self/users/search";break}var i=R(n)+r;return w(i,n).then((function(n){if(n.nextStart&&n.nextStart!==-1){n.nextPage=function(){var r;if(typeof t==="string"||t instanceof _){r={q:t,start:n.nextStart}}else{r=t;r.start=n.nextStart}return N(r,e)}}return n}))}function A(t){var e=R(t)+"/community/createGroup";t.params=a(a({},t.params),t.group);return w(e,t)}function T(t){return N(t,"group")}class D extends Error{constructor(t,e,n){super(t);this.status=n;this.url=e}}class S extends D{constructor(t,e,n,r){super(t,e,n);this.error=r}}function C(t){const{token:e,authentication:n}=t;let r=()=>Promise.resolve(e);if(n){r=n.getToken.bind(n,n.portal)}return r()}function G(t,e,n){const r=new Headers(e.headers);r.append("Content-Type","application/json");if(n){r.append("Authorization",`Bearer ${n}`)}const i={headers:r,method:e.httpMethod||"GET",mode:e.mode,cache:e.cache,credentials:e.credentials};const o=j({host:e.hubApiUrl||"https://hub.arcgis.com",path:"/api/discussions/v1"});if(e.data){if(e.httpMethod==="GET"){const n=new URLSearchParams(e.data).toString();t+=`?${n}`}else{i.body=JSON.stringify(e.data)}}const a=[o.replace(/\/$/,""),t.replace(/^\//,"")].join("/");return fetch(a,i).then((t=>{if(t.ok){return t.json()}else{const{statusText:e,status:n}=t;return t.json().then((t=>{throw new S(e,a,n,JSON.stringify(t.message))}))}}))}function U(t,e){return C(e).then((n=>G(t,e,n)))}function k(t){var e;const n=`/posts`;const r=["geometry","featureGeometry"].reduce(((t,e)=>t[e]?Object.assign(Object.assign({},t),{[e]:JSON.stringify(t[e])}):t),Object.assign({},(e=t.data)!==null&&e!==void 0?e:{}));return U(n,Object.assign(Object.assign({},t),{data:r,httpMethod:"GET"}))}function P(t){const e=`/posts`;return U(e,Object.assign({httpMethod:"POST"},q(t)))}function I(t){const e=`/posts/${t.postId}`;t.httpMethod="DELETE";return U(e,t)}function q(t){const{mentionUrl:e}=t,n=s(t,["mentionUrl"]);if(e){n.headers=Object.assign(Object.assign({},n.headers),{"mention-url":e})}return n}function F(t){t.httpMethod="GET";return U(`/channels`,t)}function x(t){t.httpMethod="POST";return U(`/channels`,t)}function H(t){t.httpMethod="POST";return U(`/reactions`,t)}var Y;(function(t){t["ASC"]="ASC";t["DESC"]="DESC"})(Y||(Y={}));var W;(function(t){t["CLAPPING_HANDS"]="clapping_hands";t["CONFUSED"]="confused";t["DOWN_ARROW"]="down_arrow";t["EYES"]="eyes";t["FACE_WITH_TEARS_OF_JOY"]="face_with_tears_of_joy";t["FIRE"]="fire";t["GRINNING"]="grinning";t["HEART"]="heart";t["LAUGH"]="laugh";t["ONE_HUNDRED"]="one_hundred";t["PARTYING"]="partying";t["PARTY_POPPER"]="party_popper";t["RAISING_HANDS"]="raising_hands";t["ROCKET"]="rocket";t["SAD"]="sad";t["SLIGHTLY_SMILING"]="slightly_smiling";t["SURPRISED"]="surprised";t["THINKING"]="thinking";t["THUMBS_UP"]="thumbs_up";t["THUMBS_DOWN"]="thumbs_down";t["TROPHY"]="trophy";t["UP_ARROW"]="up_arrow";t["WAVING_HAND"]="waving_hand";t["WINKING"]="winking";t["WORLD_MAP"]="world_map"})(W||(W={}));var J;(function(t){t["PUBLIC"]="public";t["ORG"]="org";t["PRIVATE"]="private"})(J||(J={}));var M;(function(t){t["PENDING"]="pending";t["APPROVED"]="approved";t["REJECTED"]="rejected";t["DELETED"]="deleted";t["HIDDEN"]="hidden"})(M||(M={}));var K;(function(t){t["GROUP"]="group";t["CONTENT"]="content";t["BOARD"]="board"})(K||(K={}));var B;(function(t){t["HUB"]="hub";t["AGO"]="ago";t["URBAN"]="urban"})(B||(B={}));var L;(function(t){t["REPLIES"]="replies";t["REACTIONS"]="reactions";t["PARENT"]="parent";t["CHANNEL"]="channel"})(L||(L={}));var $;(function(t){t["POST"]="post"})($||($={}));var z;(function(t){t["HAS_USER_POSTS"]="has_user_posts"})(z||(z={}));var Q;(function(t){t["CREATED_AT"]="createdAt";t["CREATOR"]="creator";t["EDITOR"]="editor";t["ID"]="id";t["UPDATED_AT"]="updatedAt"})(Q||(Q={}));var V;(function(t){t["READ"]="read";t["WRITE"]="write";t["READWRITE"]="readWrite";t["MODERATE"]="moderate";t["MANAGE"]="manage";t["OWNER"]="owner"})(V||(V={}));var X;(function(t){t["BODY"]="body";t["CHANNEL_ID"]="channelId";t["CREATED_AT"]="createdAt";t["CREATOR"]="creator";t["DISCUSSION"]="discussion";t["EDITOR"]="editor";t["ID"]="id";t["PARENT_ID"]="parentId";t["STATUS"]="status";t["TITLE"]="title";t["UPDATED_AT"]="updatedAt"})(X||(X={}));var Z;(function(t){t["Text"]="text";t["Announcement"]="announcement";t["Poll"]="poll";t["Question"]="question"})(Z||(Z={}));var tt;(function(t){t["ACCESS"]="access";t["CREATED_AT"]="createdAt";t["CREATOR"]="creator";t["EDITOR"]="editor";t["ID"]="id";t["LAST_ACTIVITY"]="last_activity";t["UPDATED_AT"]="updatedAt"})(tt||(tt={}));var et;(function(t){t["CHANNEL_ACL"]="channelAcl"})(et||(et={}));var nt;(function(t){t["GROUP"]="group";t["ORG"]="org";t["USER"]="user";t["ANONYMOUS_USER"]="anonymousUser";t["AUTHENTICATED_USER"]="authenticatedUser"})(nt||(nt={}));var rt;(function(t){t["ADMIN"]="admin";t["MEMBER"]="member"})(rt||(rt={}));const it="hubChatHistory";async function ot(e){return I(Object.assign({postId:e},t.context.hubRequestOptions))}async function at(e=null,n=W.EYES){if(!e){return null}return H(Object.assign({data:{postId:e,value:n}},t.context.hubRequestOptions))}async function st(){let e=null;const n=(new _).match(it).in("typekeywords");const r=await T(Object.assign({q:n},t.context.hubRequestOptions));console.debug("Find chat history group",r);if(r.results.length>0){e=r.results[0]}else{const n=await A(Object.assign({group:{title:"Chat History",access:"private",typeKeywords:[it]}},t.context.hubRequestOptions));console.debug("Chat History createGroupResponse",n);if(n.success){e=n.group}}return e}async function ut(e){if(!!e){const n=await x(Object.assign({data:{name:"Chat History",groups:[e.id],access:J.PRIVATE}},t.context.hubRequestOptions));return n}}let ct=null;async function ft(){ct=await lt();const e=await k(Object.assign({data:{channels:[ct.id]}},t.context.hubRequestOptions));return e.items}async function ht(e){const n=await P(Object.assign({data:{channelId:ct.id,body:e,discussion:"hub://compass/general"}},t.context.hubRequestOptions));return n}async function lt(){const e=await st();let n=null;console.debug("user",t.user);const r=await F(Object.assign({data:{groups:[e.id]}},t.context.hubRequestOptions));console.debug("searchChannels",r);if(r.items.length>0){n=r.items[0]}else{n=await ut(e)}console.debug("chatHistoryChannel",n);return n}export{e as C,n as H,W as P,ht as a,r as b,at as c,ot as d,ft as g};
//# sourceMappingURL=p-a0317700.js.map