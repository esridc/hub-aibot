import{s as t}from"./p-6c99a78d.js";var e;(function(t){t["Popup"]="popup";t["Modal"]="modal"})(e||(e={}));var n;(function(t){t["Nearby"]="nearby";t["Text"]="text";t["Image"]="image"})(n||(n={}));var r;(function(t){t["user"]="user";t["hub"]="hub";t["system"]="system"})(r||(r={}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function s(t,e){var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0)n[r]=t[r];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++){if(e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s]))n[r[s]]=t[r[s]]}return n}function o(t){return Object.keys(t).some((e=>{let n=t[e];if(!n){return false}if(n&&n.toParam){n=n.toParam()}const r=n.constructor.name;switch(r){case"Array":return false;case"Object":return false;case"Date":return false;case"Function":return false;case"Boolean":return false;case"String":return false;case"Number":return false;default:return true}}))}function i(t){const e={};Object.keys(t).forEach((n=>{var r,s;let o=t[n];if(o&&o.toParam){o=o.toParam()}if(!o&&o!==0&&typeof o!=="boolean"&&typeof o!=="string"){return}const i=o.constructor.name;let a;switch(i){case"Array":const t=(s=(r=o[0])===null||r===void 0?void 0:r.constructor)===null||s===void 0?void 0:s.name;a=t==="Array"?o:t==="Object"?JSON.stringify(o):o.join(",");break;case"Object":a=JSON.stringify(o);break;case"Date":a=o.valueOf();break;case"Function":a=null;break;case"Boolean":a=o+"";break;default:a=o;break}if(a||a===0||typeof a==="string"||Array.isArray(a)){e[n]=a}}));return e}function a(t,e){if(Array.isArray(e)&&e[0]&&Array.isArray(e[0])){return e.map((e=>a(t,e))).join("&")}return encodeURIComponent(t)+"="+encodeURIComponent(e)}function c(t){const e=i(t);return Object.keys(e).map((t=>a(t,e[t]))).join("&")}var u={FormData:globalThis.FormData,File:globalThis.File,Blob:globalThis.Blob};function h(t,e){const n=o(t)||e;const r=i(t);if(n){const t=new u.FormData;Object.keys(r).forEach((e=>{if(typeof Blob!=="undefined"&&r[e]instanceof Blob){const n=r["fileName"]||r[e].name||e;t.append(e,r[e],n)}else{t.append(e,r[e])}}));return t}else{return c(t)}}class f extends Error{constructor(t,e,n,r,s){super(t);const o=new.target.prototype;Object.setPrototypeOf(this,o);t=t||"UNKNOWN_ERROR";e=e||"UNKNOWN_ERROR_CODE";this.name="ArcGISRequestError";this.message=e==="UNKNOWN_ERROR_CODE"?t:`${e}: ${t}`;this.originalMessage=t;this.code=e;this.response=n;this.url=r;this.options=s}}function l(t){if(console&&console.warn){console.warn.apply(console,[t])}}var d=function t(){return Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.request})};const p=`@esri/arcgis-rest-js`;function m(){return globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}}}class b extends f{constructor(t="AUTHENTICATION_ERROR",e="AUTHENTICATION_ERROR_CODE",n,r,s){super(t,e,n,r,s);this.name="ArcGISAuthError";this.message=e==="AUTHENTICATION_ERROR_CODE"?t:`${e}: ${t}`;const o=new.target.prototype;Object.setPrototypeOf(this,o)}retry(t,e=1){let n=0;const r=(s,o)=>{n=n+1;t(this.url,this.options).then((t=>{const e=Object.assign(Object.assign({},this.options),{authentication:t});return w(this.url,e)})).then((t=>{s(t)})).catch((t=>{if(t.name==="ArcGISAuthError"&&n<e){r(s,o)}else if(t.name===this.name&&t.message===this.message&&n>=e){o(this)}else{o(t)}}))};return new Promise(((t,e)=>{r(t,e)}))}}function g(t,e,n,r,s){if(t.code>=400){const{message:n,code:s}=t;throw new f(n,s,t,e,r)}if(t.error){const{message:n,code:o,messageCode:i}=t.error;const a=i||o||"UNKNOWN_ERROR_CODE";if(o===498||o===499){if(s){throw s}else{throw new b(n,a,t,e,r)}}throw new f(n,a,t,e,r)}if(t.status==="failed"||t.status==="failure"){let n;let s="UNKNOWN_ERROR_CODE";try{n=JSON.parse(t.statusMessage).message;s=JSON.parse(t.statusMessage).code}catch(e){n=t.statusMessage||t.message}throw new f(n,s,t,e,r)}return t}function w(t,e){const n=m();const r=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},n),e),{params:Object.assign(Object.assign({},n.params),e.params),headers:Object.assign(Object.assign({},n.headers),e.headers)});const{httpMethod:s,rawResponse:i}=r;const a=Object.assign({f:"json"},r.params);let u=null;const b={method:s,signal:r.signal,credentials:r.credentials||"same-origin"};if(r.headers&&r.headers["X-Esri-Auth-Client-Id"]&&t.indexOf("/oauth2/platformSelf")>-1){b.credentials="include"}let w;if(typeof r.authentication==="string"){const t=r.authentication;w={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(t)};if(!r.authentication.startsWith("AAPK")&&!r.suppressWarnings&&!globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING){l(`Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information.`);globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=true}}else{w=r.authentication}const O=t;return(w?w.getToken(t).catch((e=>{e.url=t;e.options=r;u=e;return Promise.resolve("")})):Promise.resolve("")).then((e=>{if(e.length){a.token=e}if(w&&w.getDomainCredentials){b.credentials=w.getDomainCredentials(t)}const n={};if(b.method==="GET"){if(a.token&&r.hideToken&&typeof window==="undefined"){n["X-Esri-Authorization"]=`Bearer ${a.token}`;delete a.token}const s=c(a);const o=s===""?t:t+"?"+c(a);if(r.maxUrlLength&&o.length>r.maxUrlLength||a.token&&r.hideToken){b.method="POST";if(e.length&&r.hideToken){a.token=e;delete n["X-Esri-Authorization"]}}else{t=o}}const s=new RegExp("/items/.+/updateResources").test(t);if(b.method==="POST"){b.body=h(a,s)}b.headers=Object.assign(Object.assign({},n),r.headers);if((typeof window==="undefined"||window&&typeof window.document==="undefined")&&!b.headers.referer){b.headers.referer=p}if(!o(a)&&!s){b.headers["Content-Type"]="application/x-www-form-urlencoded"}return globalThis.fetch?globalThis.fetch(t,b):d().then((({fetch:e})=>e(t,b)))})).then((e=>{if(!e.ok){return e.json().then((n=>{const{status:s,statusText:o}=e;const{message:i,details:a}=n.error;const c=`${i}. ${a?a.join(" "):""}`.trim();throw new f(c,`HTTP ${s} ${o}`,n,t,r)})).catch((n=>{if(n.name==="ArcGISRequestError"){throw n}const{status:s,statusText:o}=e;throw new f(o,`HTTP ${s}`,e,t,r)}))}if(i){return e}switch(a.f){case"json":return e.json();case"geojson":return e.json();case"html":return e.text();case"text":return e.text();default:return e.blob()}})).then((e=>{if((a.f==="json"||a.f==="geojson")&&!i){const n=g(e,O,a,r,u);if(u){const e=t.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];r.authentication.federatedServers[e]={token:[],expires:new Date(Date.now()+86400*1e3)};u=null}return n}else{return e}}))}function O(t,e={params:{f:"json"}}){return w(t,e).catch((t=>{if(t instanceof b&&e.authentication&&typeof e.authentication!=="string"&&e.authentication.canRefresh&&e.authentication.refreshCredentials){return t.retry((()=>e.authentication.refreshCredentials()),1)}else{return Promise.reject(t)}}))}function y(t,e,n){const r=["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"];const s=Object.assign(Object.assign({params:{}},n),t);s.params=e.reduce(((e,n)=>{if(t[n]||typeof t[n]==="boolean"||typeof t[n]==="number"&&t[n]===0){e[n]=t[n]}return e}),s.params);return r.reduce(((t,e)=>{if(s[e]){t[e]=s[e]}return t}),{})}function j(t){if(typeof t!=="string"){return t}t=t.trim();if(t[t.length-1]==="/"){t=t.slice(0,-1)}return t}function T(t){const{host:e,path:n,query:r}=t;const s=e.endsWith("/")?e:`${e}/`;const o=new URL(n,s);o.search=v(r);return o.toString()}function v(t={}){const e=Object.keys(t).filter((e=>t[e]!==undefined)).reduce(((e,n)=>{e[n]=t[n];return e}),{});return new URLSearchParams(e).toString()}function R(t={}){if(t.portal){return j(t.portal)}if(t.authentication&&typeof t.authentication!=="string"){return t.authentication.portal}return"https://www.arcgis.com/sharing/rest"}class E{constructor(t=""){this.termStack=[];this.rangeStack=[];this.openGroups=0;this.q=t}match(...t){this.termStack=this.termStack.concat(t);return this}in(t){const e=`\`in(${t?`"${t}"`:""})\``;if(!this.hasRange&&!this.hasTerms){l(`${e} was called with no call to \`match(...)\` or \`from(...)\`/\`to(...)\`. Your query was not modified.`);return this}if(t&&t!=="*"){this.q+=`${t}:`}return this.commit()}startGroup(){this.commit();if(this.openGroups>0){this.q+=" "}this.openGroups++;this.q+="(";return this}endGroup(){if(this.openGroups<=0){l(`\`endGroup(...)\` was called without calling \`startGroup(...)\` first. Your query was not modified.`);return this}this.commit();this.openGroups--;this.q+=")";return this}and(){return this.addModifier("and")}or(){return this.addModifier("or")}not(){return this.addModifier("not")}from(t){if(this.hasTerms){l(`\`from(...)\` is not allowed after \`match(...)\` try using \`.from(...).to(...).in(...)\`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.`);return this}this.rangeStack[0]=t;return this}to(t){if(this.hasTerms){l(`\`to(...)\` is not allowed after \`match(...)\` try using \`.from(...).to(...).in(...)\`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.`);return this}this.rangeStack[1]=t;return this}boost(t){this.commit();this.q+=`^${t}`;return this}toParam(){this.commit();this.cleanup();return this.q}clone(){this.commit();this.cleanup();return new E(this.q+"")}addModifier(t){if(this.currentModifer){l(`You have called \`${this.currentModifer}()\` after \`${t}()\`. Your current query was not modified.`);return this}this.commit();if(this.q===""&&t!=="not"){l(`You have called \`${t}()\` without calling another method to modify your query first. Try calling \`match()\` first.`);return this}this.currentModifer=t;this.q+=this.q===""?"":" ";this.q+=`${t.toUpperCase()} `;return this}hasWhiteSpace(t){return/\s/g.test(t)}formatTerm(t){if(t instanceof Date){return t.getTime()}if(typeof t==="string"&&this.hasWhiteSpace(t)){return`"${t}"`}return t}commit(){this.currentModifer=undefined;if(this.hasRange){this.q+=`[${this.formatTerm(this.rangeStack[0])} TO ${this.formatTerm(this.rangeStack[1])}]`;this.rangeStack=[undefined,undefined]}if(this.hasTerms){this.q+=this.termStack.map((t=>this.formatTerm(t))).join(" ");this.termStack=[]}return this}get hasTerms(){return this.termStack.length>0}get hasRange(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]}cleanup(){if(this.openGroups>0){l(`Automatically closing ${this.openGroups} group(s). You can use \`endGroup(...)\` to remove this warning.`);while(this.openGroups>0){this.q+=")";this.openGroups--}}const t=this.q;this.q=t.replace(/( AND ?| NOT ?| OR ?)*$/,"");if(t!==this.q){l(`\`startGroup(...)\` was called without calling \`endGroup(...)\` first. Your query was not modified.`)}this.q=this.q.replace(/(\(\))*/,"")}}function A(t,e){let n;if(typeof t==="string"||t instanceof E){n={httpMethod:"GET",params:{q:t}}}else{n=y(t,["q","num","start","sortField","sortOrder","searchUserAccess","searchUserName","filter","countFields","countSize","categories","categoryFilters"],{httpMethod:"GET"})}let r;switch(e){case"item":r="/search";break;case"group":r="/community/groups";break;case"groupContent":if(typeof t!=="string"&&!(t instanceof E)&&t.groupId){r=`/content/groups/${t.groupId}/search`}else{return Promise.reject(new Error("you must pass a `groupId` option to `searchGroupContent`"))}break;default:r="/portals/self/users/search";break}const s=R(n)+r;return O(s,n).then((n=>{if(n.nextStart&&n.nextStart!==-1){n.nextPage=function(){let r;if(typeof t==="string"||t instanceof E){r={q:t,start:n.nextStart}}else{r=t;r.start=n.nextStart}return A(r,e)}}return n}))}function N(t){const e=`${R(t)}/community/createGroup`;t.params=Object.assign(Object.assign({},t.params),t.group);return O(e,t)}function _(t){return A(t,"group")}class $ extends Error{constructor(t,e,n){super(t);this.status=n;this.url=e}}class S extends ${constructor(t,e,n,r){super(t,e,n);this.error=r}}function C(t){const{token:e,authentication:n}=t;let r=()=>Promise.resolve(e);if(n){r=n.getToken.bind(n,n.portal)}return r()}function D(t,e,n){const r=new Headers(e.headers);r.append("Content-Type","application/json");if(n){r.append("Authorization",`Bearer ${n}`)}const s={headers:r,method:e.httpMethod||"GET",mode:e.mode,cache:e.cache,credentials:e.credentials};const o=T({host:e.hubApiUrl||"https://hub.arcgis.com",path:"/api/discussions/v1"});if(e.data){if(e.httpMethod==="GET"){const n=new URLSearchParams(e.data).toString();t+=`?${n}`}else{s.body=JSON.stringify(e.data)}}const i=[o.replace(/\/$/,""),t.replace(/^\//,"")].join("/");return fetch(i,s).then((t=>{if(t.ok){return t.json()}else{const{statusText:e,status:n}=t;return t.json().then((t=>{throw new S(e,i,n,JSON.stringify(t.message))}))}}))}function G(t,e){return C(e).then((n=>D(t,e,n)))}function k(t){var e;const n=`/posts`;const r=["geometry","featureGeometry"].reduce(((t,e)=>t[e]?Object.assign(Object.assign({},t),{[e]:JSON.stringify(t[e])}):t),Object.assign({},(e=t.data)!==null&&e!==void 0?e:{}));return G(n,Object.assign(Object.assign({},t),{data:r,httpMethod:"GET"}))}function P(t){const e=`/posts`;return G(e,Object.assign({httpMethod:"POST"},I(t)))}function U(t){const e=`/posts/${t.postId}`;t.httpMethod="DELETE";return G(e,t)}function I(t){const{mentionUrl:e}=t,n=s(t,["mentionUrl"]);if(e){n.headers=Object.assign(Object.assign({},n.headers),{"mention-url":e})}return n}function q(t){t.httpMethod="GET";return G(`/channels`,t)}function x(t){t.httpMethod="POST";return G(`/channels`,t)}function H(t){t.httpMethod="POST";return G(`/reactions`,t)}var M;(function(t){t["ASC"]="ASC";t["DESC"]="DESC"})(M||(M={}));var Y;(function(t){t["CLAPPING_HANDS"]="clapping_hands";t["CONFUSED"]="confused";t["DOWN_ARROW"]="down_arrow";t["EYES"]="eyes";t["FACE_WITH_TEARS_OF_JOY"]="face_with_tears_of_joy";t["FIRE"]="fire";t["GRINNING"]="grinning";t["HEART"]="heart";t["LAUGH"]="laugh";t["ONE_HUNDRED"]="one_hundred";t["PARTYING"]="partying";t["PARTY_POPPER"]="party_popper";t["RAISING_HANDS"]="raising_hands";t["ROCKET"]="rocket";t["SAD"]="sad";t["SLIGHTLY_SMILING"]="slightly_smiling";t["SURPRISED"]="surprised";t["THINKING"]="thinking";t["THUMBS_UP"]="thumbs_up";t["THUMBS_DOWN"]="thumbs_down";t["TROPHY"]="trophy";t["UP_ARROW"]="up_arrow";t["WAVING_HAND"]="waving_hand";t["WINKING"]="winking";t["WORLD_MAP"]="world_map"})(Y||(Y={}));var F;(function(t){t["PUBLIC"]="public";t["ORG"]="org";t["PRIVATE"]="private"})(F||(F={}));var B;(function(t){t["PENDING"]="pending";t["APPROVED"]="approved";t["REJECTED"]="rejected";t["DELETED"]="deleted";t["HIDDEN"]="hidden"})(B||(B={}));var J;(function(t){t["GROUP"]="group";t["CONTENT"]="content";t["BOARD"]="board"})(J||(J={}));var K;(function(t){t["HUB"]="hub";t["AGO"]="ago";t["URBAN"]="urban"})(K||(K={}));var W;(function(t){t["REPLIES"]="replies";t["REACTIONS"]="reactions";t["PARENT"]="parent";t["CHANNEL"]="channel"})(W||(W={}));var L;(function(t){t["POST"]="post"})(L||(L={}));var z;(function(t){t["HAS_USER_POSTS"]="has_user_posts"})(z||(z={}));var Q;(function(t){t["CREATED_AT"]="createdAt";t["CREATOR"]="creator";t["EDITOR"]="editor";t["ID"]="id";t["UPDATED_AT"]="updatedAt"})(Q||(Q={}));var V;(function(t){t["READ"]="read";t["WRITE"]="write";t["READWRITE"]="readWrite";t["MODERATE"]="moderate";t["MANAGE"]="manage";t["OWNER"]="owner"})(V||(V={}));var X;(function(t){t["BODY"]="body";t["CHANNEL_ID"]="channelId";t["CREATED_AT"]="createdAt";t["CREATOR"]="creator";t["DISCUSSION"]="discussion";t["EDITOR"]="editor";t["ID"]="id";t["PARENT_ID"]="parentId";t["STATUS"]="status";t["TITLE"]="title";t["UPDATED_AT"]="updatedAt"})(X||(X={}));var Z;(function(t){t["Text"]="text";t["Announcement"]="announcement";t["Poll"]="poll";t["Question"]="question"})(Z||(Z={}));var tt;(function(t){t["ACCESS"]="access";t["CREATED_AT"]="createdAt";t["CREATOR"]="creator";t["EDITOR"]="editor";t["ID"]="id";t["LAST_ACTIVITY"]="last_activity";t["UPDATED_AT"]="updatedAt"})(tt||(tt={}));var et;(function(t){t["CHANNEL_ACL"]="channelAcl"})(et||(et={}));var nt;(function(t){t["GROUP"]="group";t["ORG"]="org";t["USER"]="user";t["ANONYMOUS_USER"]="anonymousUser";t["AUTHENTICATED_USER"]="authenticatedUser"})(nt||(nt={}));var rt;(function(t){t["ADMIN"]="admin";t["MEMBER"]="member"})(rt||(rt={}));const st="hubChatHistory";async function ot(e){return U(Object.assign({postId:e},t.context.hubRequestOptions))}async function it(e=null,n=Y.EYES){if(!e){return null}return H(Object.assign({data:{postId:e,value:n}},t.context.hubRequestOptions))}async function at(){let e=null;const n=(new E).match(st).in("typekeywords");const r=await _(Object.assign({q:n},t.context.hubRequestOptions));console.debug("Find chat history group",r);if(r.results.length>0){e=r.results[0]}else{const n=await N(Object.assign({group:{title:"Chat History",access:"private",typeKeywords:[st]}},t.context.hubRequestOptions));console.debug("Chat History createGroupResponse",n);if(n.success){e=n.group}}return e}async function ct(e){if(!!e){const n=await x(Object.assign({data:{name:"Chat History",groups:[e.id],access:F.PRIVATE}},t.context.hubRequestOptions));return n}}let ut=null;async function ht(){ut=await lt();const e=await k(Object.assign({data:{num:100,channels:[ut.id]}},t.context.hubRequestOptions));return e.items}async function ft(e){const n=await P(Object.assign({data:{channelId:ut.id,body:e,discussion:"hub://compass/general"}},t.context.hubRequestOptions));return n}async function lt(){const e=await at();let n=null;console.debug("user",t.user);const r=await q(Object.assign({data:{groups:[e.id]}},t.context.hubRequestOptions));console.debug("searchChannels",r);if(r.items.length>0){n=r.items[0]}else{n=await ct(e)}console.debug("chatHistoryChannel",n);return n}export{e as C,n as H,Y as P,ft as a,r as b,it as c,ot as d,ht as g};
//# sourceMappingURL=p-481973a7.js.map